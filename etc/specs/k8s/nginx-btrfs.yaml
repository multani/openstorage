apiVersion: v1
kind: Pod
metadata:
  name: nginx-btrfs
spec:
  hostIPC: true
  hostNetwork: true
  containers:
  - name: nginx
    image: nginx
    securityContext:
      privileged: true
    volumeMounts:
    - name: test
      mountPath: /data
    - name: lib
      mountPath: /var/lib/kubelet
    - name: run
      mountPath: /run
    - name: sys
      mountPath: /sys
    - name: openstorage
      mountPath: /var/lib/openstorage/
    ports:
    - containerPort: 80
  volumes:
    - name: test
      flexVolume:
        driver: "osd/flexvolume"
        fsType: "btrfs"
        options:
          volumeID: "/var/lib/opentorage/btrfs.img"
          size: "1G"
          osdDriver: "btrfs"
    - name: lib
      hostPath:
        path: /var/lib/kubelet
    - name: run
      hostPath:
        path: /run
    - name: sys
      hostPath:
        path: /sys
    - name: openstorage
      hostPath:
        path: /var/lib/openstorage
